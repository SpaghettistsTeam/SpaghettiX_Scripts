-- ragebotæ„¤æ€’çš„æœºå™¨äººåˆ¶ä½œæ•™ç¨‹
-- ä½ å¾—è‡ªå·±å­¦ä¼šæŠ“äº‹ä»¶
-- æ²¡æœ‰wallbangä½ è‡ªå·±å†™
-- é€‚ç”¨äºå¤§éƒ¨åˆ†FPSç±»å’Œè¿‘æˆ˜ç±»
-- åé¢ä½ å¾—è‡ªå·±æ”¹UIå¼€å…³ 
-- ä½ æƒ³è¦åˆ¶ä½œæˆè„šæœ¬çš„å½¢å¼ å°±åˆ é™¤å¼€å…³ç±»çš„ ç„¶åæ”¹æˆå¾ªç¯æ­»äº¡å°±æ‰çš„
local Players = game:GetService("Players") 
local ReplicatedStore = game:GetService("ReplicatedStorage") 
local RunService = game:GetService("RunService") 
local DebrisService = game:GetService("Debris") 

local LocalPlayer = Players.LocalPlayer -- è·å–ä½ è‡ªå·±

-- è¿œç¨‹æ”»å‡»(è‡ªå·±ç”¨dexæŠ“å°„å‡»äº‹ä»¶ï¼‰
local AttackRemoteA = ReplicatedStore.Remotes.ZombieRelated.PlayerAttack -- è¿‘æˆ˜æ”»å‡»äº‹ä»¶
local BulletRemote = ReplicatedStore.Remotes.Guns.ReplicateBullet -- å­å¼¹è½¨è¿¹äº‹ä»¶
local DamageRemote = ReplicatedStore.NetworkEvents.RemoteEvent -- ä¼¤å®³äº‹ä»¶äº‹ä»¶

-- é¢‘ç‡
local attackIntervalA = 0.3 -- Aè¿‘æˆ˜æ”»å‡»é—´éš”
local attackIntervalB = 0.01 -- Bè¿œç¨‹æ”»å‡»é—´éš”

-- æ§åˆ¶
local attackingA = false -- è¿‘æˆ˜æ”»å‡»å¼€å…³
local attackingB = false -- è¿œç¨‹æ”»å‡»å¼€å…³
local rotating = false -- æ—‹è½¬å¼€å…³

-- ç§»åŠ¨å±æ€§
local DEFAULT_WALKSPEED = 16 
local DEFAULT_JUMPPOWER = 50 
local currentSpeed = 100 
local currentJump = 100 
local speedEnabled = false 
local jumpEnabled = false 

-- åˆ›å»ºæ”»å‡»è½¨è¿¹ç‰¹æ•ˆ
local function createTrail(origin, targetPos)
	local part = Instance.new("Part") 
	part.Size = Vector3.new(0.2, 0.2, 0.2) -- å°ºå¯¸
	part.Anchored = true -- å›ºå®š
	part.CanCollide = false -- æ— ç¢°æ’
	part.Transparency = 1 -- é€æ˜åº¦
	part.CFrame = CFrame.new(origin) -- è®¾ç½®ä½ç½®
	part.Parent = workspace 

	local att0 = Instance.new("Attachment", part) -- èµ·ç‚¹é™„ç€ç‚¹
	local att1 = Instance.new("Attachment", workspace.Terrain) -- ç»ˆç‚¹é™„ç€ç‚¹
	att1.WorldPosition = targetPos -- è®¾ç½®ç»ˆç‚¹ä½ç½®

	local beam = Instance.new("Beam", part) -- åˆ›å»ºå…‰æŸ
	beam.Attachment0 = att0 
	beam.Attachment1 = att1 
	beam.Color = ColorSequence.new(Color3.fromRGB(0, 170, 255)) -- é¢œè‰²å…‰æŸ
	beam.Width0 = 0.3 -- èµ·ç‚¹å®½åº¦
	beam.Width1 = 0.3 -- ç»ˆç‚¹å®½åº¦
	beam.FaceCamera = true 
	beam.LightEmission = 1 -- äº®åº¦

	DebrisService:AddItem(part, 0.2) -- æ˜¾ç¤ºæ—¶é—´
end

-- æ”»å‡»è¿‘æˆ˜ç©å®¶
task.spawn(function()
    while true do
        if attackingA and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
            local myPos = LocalPlayer.Character.HumanoidRootPart.Position 
            for _, plr in pairs(Players:GetPlayers()) do 
                if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("Head") then 
                    local dist = (plr.Character.Head.Position - myPos).Magnitude 
                    if dist <= 22 then -- 22ç±³èŒƒå›´å†…
                        pcall(function() 
                            -- å‘Šè¯‰æœåŠ¡å™¨ğŸ¥µğŸ¥µâ€œæˆ‘æ‰“ä¸­äº†è¿™ä¸ªå…¥å¤´â€
                            AttackRemoteA:InvokeServer(plr.Character.Head)
                        end)
                    end
                end
            end
            task.wait(attackIntervalA) -- ç­‰0.3ç§’å†æ‰“
        else
            task.wait(0.1) -- æ²¡å¼€æ”»å‡»å°±ç­‰0.1ç§’
        end
    end
end)

-- è¿œç¨‹æ”»å‡»ç©å®¶
task.spawn(function()
	while true do
		local char = LocalPlayer.Character
		local hrp = char and char:FindFirstChild("HumanoidRootPart") 
		local hasCrossbow = char and char:FindFirstChild("Crossbow") -- æ£€æŸ¥æ˜¯å¦æ‰‹æŒå¯¹åº”çš„æ­¦å™¨ï¼ˆæ­¦å™¨è¦æ±‚ï¼‰
		if attackingB and hrp and hasCrossbow then 
			local myPos = hrp.Position 
			for _, plr in pairs(Players:GetPlayers()) do 
				if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then 
					local targetHRP = plr.Character.HumanoidRootPart 
					local dist = (targetHRP.Position - myPos).Magnitude 
					if dist <= 100 then -- 100ç±³èŒƒå›´å†…ï¼ˆè¿‡å¤§å¯èƒ½ä¼šè¡°å‡ä¼¤å®³ é™¤åä½œå¼Šåƒåœ¾çš„ï¼‰
						pcall(function() 
							BulletRemote:FireServer({myPos, targetHRP.Position}) -- å‘é€è½¨è¿¹
							DamageRemote:FireServer("GUN_DAMAGE", plr.Character) -- å‘é€ä¼¤å®³
						end)
						createTrail(myPos, targetHRP.Position) -- æ˜¾ç¤ºè½¨è¿¹ç‰¹æ•ˆ
						-- æ’­æ”¾å°„å‡»éŸ³æ•ˆï¼ˆç»™è‡ªå·±å¬ï¼‰
						local snd = Instance.new("Sound", workspace)
						snd.SoundId = "rbxassetid://9116483270"
						snd.Volume = 1
						snd.PlayOnRemove = true
						snd:Destroy()
						task.wait(attackIntervalB) 
					end
				end
			end
		else
			task.wait(0.01) 
		end
	end
end)

-- æ”»å‡»NPC
task.spawn(function()
	while true do
		local char = LocalPlayer.Character
		local hrp = char and char:FindFirstChild("HumanoidRootPart") 
		local hasCrossbow = char and char:FindFirstChild("Crossbow") -- æ£€æŸ¥æ˜¯å¦æ‰‹æŒå¯¹åº”çš„æ­¦å™¨ï¼ˆæ­¦å™¨è¦æ±‚ï¼‰
		if attackingB and hrp and hasCrossbow then 
			local myPos = hrp.Position 
			for _, npc in pairs(workspace.LivingThings:GetChildren()) do 
				local targetHRP = npc:FindFirstChild("HumanoidRootPart") 
				if targetHRP then
					local dist = (targetHRP.Position - myPos).Magnitude 
					if dist <= 100 then -- 100ç±³èŒƒå›´å†…ï¼ˆè¿‡å¤§å¯èƒ½ä¼šè¡°å‡ä¼¤å®³ é™¤åä½œå¼Šåƒåœ¾çš„ï¼‰
						pcall(function()
							BulletRemote:FireServer({myPos, targetHRP.Position}) -- å‘é€è½¨è¿¹
							DamageRemote:FireServer("GUN_DAMAGE", npc) -- å‘é€ä¼¤å®³
						end)
						createTrail(myPos, targetHRP.Position) -- æ˜¾ç¤ºè½¨è¿¹ç‰¹æ•ˆ
						-- æ’­æ”¾å°„å‡»éŸ³æ•ˆï¼ˆç»™è‡ªå·±å¬ï¼‰
						local snd = Instance.new("Sound", workspace)
						snd.SoundId = "rbxassetid://9116483270"
						snd.Volume = 1
						snd.PlayOnRemove = true 
						snd:Destroy() 
						task.wait(attackIntervalB) 
					end
				end
			end
		else
			task.wait(0.01) 
		end
	end
end)

-- äººç‰©æ—‹è½¬åŠŸèƒ½ï¼ˆæ”»å‡»æ—¶è½¬å¤´ æ²¡è¡¨è¦çš„ä¸œè¥¿ï¼‰
local rotateConn 
local function startRotate()
	if rotating then return end 
	local root = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
	if not root then return end 
	rotating = true 
	rotateConn = RunService.RenderStepped:Connect(function(dt) 
		root.CFrame = root.CFrame * CFrame.Angles(0, math.rad(7200) * dt, 0) -- Yè½´æ—‹è½¬
	end)
end

local function stopRotate()
	rotating = false 
	if rotateConn then
		rotateConn:Disconnect() 
		rotateConn = nil
	end
end

-- ç§»åŠ¨å±æ€§å‡½æ•°
local function updateMovement()
	local humanoid = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
	if humanoid then
		humanoid.WalkSpeed = speedEnabled and currentSpeed or DEFAULT_WALKSPEED
		humanoid.JumpPower = jumpEnabled and currentJump or DEFAULT_JUMPPOWER
	end
end

